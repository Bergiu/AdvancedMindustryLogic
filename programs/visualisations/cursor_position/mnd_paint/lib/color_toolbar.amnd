import ./color4d.amnd


struct SelectColorToolbar(mem, x_start, tools_width)


# Functions:
# draw_color_toolbar:
#   draws the color toolbar
# select_color:
#   saves the selected color into the memory

function update_selected_color(SelectColorToolbar update_selected_color::config, Color4D update_selected_color::mem_pos_color) {
    # selected color
    read update_selected_color::color.r update_selected_color::config.mem update_selected_color::mem_pos_color.r
    read update_selected_color::color.g update_selected_color::config.mem update_selected_color::mem_pos_color.g
    read update_selected_color::color.b update_selected_color::config.mem update_selected_color::mem_pos_color.b
    read update_selected_color::color.t update_selected_color::config.mem update_selected_color::mem_pos_color.t
    draw color update_selected_color::color.r update_selected_color::color.g update_selected_color::color.b update_selected_color::color.t 0 0
    draw rect update_selected_color::config.x_start 0 update_selected_color::config.tools_width update_selected_color::config.tools_width 0 0
}

function draw_color_toolbar(SelectColorToolbar draw_color_toolbar::config, Color4D draw_color_toolbar::mem_pos_color) {
    # border
    draw color 128 128 128 255 0 0
    draw_color_toolbar::end_x = draw_color_toolbar::config.x_start + draw_color_toolbar::config.tools_width + 1
    draw line draw_color_toolbar::end_x 0 draw_color_toolbar::end_x 176 0 0
    # black
    draw color 0 0 0 255 0 0
    draw_color_toolbar::y = 176 - draw_color_toolbar::config.tools_width
    g::color_toolbar::black_pos = draw_color_toolbar::y
    draw rect draw_color_toolbar::config.x_start draw_color_toolbar::y draw_color_toolbar::config.tools_width draw_color_toolbar::config.tools_width 0 0
    # gray
    draw color 128 128 128 255 0 0
    draw_color_toolbar::y -= draw_color_toolbar::config.tools_width
    g::color_toolbar::gray_pos = draw_color_toolbar::y
    draw rect draw_color_toolbar::config.x_start draw_color_toolbar::y draw_color_toolbar::config.tools_width draw_color_toolbar::config.tools_width 0 0
    # white
    draw color 255 255 255 255 0 0
    draw_color_toolbar::y -= draw_color_toolbar::config.tools_width
    g::color_toolbar::white_pos = draw_color_toolbar::y
    draw rect draw_color_toolbar::config.x_start draw_color_toolbar::y draw_color_toolbar::config.tools_width draw_color_toolbar::config.tools_width 0 0
    # red
    draw color 255 0 0 255 0 0
    draw_color_toolbar::y -= draw_color_toolbar::config.tools_width
    g::color_toolbar::red_pos = draw_color_toolbar::y
    draw rect draw_color_toolbar::config.x_start draw_color_toolbar::y draw_color_toolbar::config.tools_width draw_color_toolbar::config.tools_width 0 0
    # green
    draw color 0 255 0 255 0 0
    draw_color_toolbar::y -= draw_color_toolbar::config.tools_width
    g::color_toolbar::green_pos = draw_color_toolbar::y
    draw rect draw_color_toolbar::config.x_start draw_color_toolbar::y draw_color_toolbar::config.tools_width draw_color_toolbar::config.tools_width 0 0
    # blue
    draw color 0 0 255 255 0 0
    draw_color_toolbar::y -= draw_color_toolbar::config.tools_width
    g::color_toolbar::blue_pos = draw_color_toolbar::y
    draw rect draw_color_toolbar::config.x_start draw_color_toolbar::y draw_color_toolbar::config.tools_width draw_color_toolbar::config.tools_width 0 0
    # yellow
    draw color 255 255 0 255 0 0
    draw_color_toolbar::y -= draw_color_toolbar::config.tools_width
    g::color_toolbar::yellow_pos = draw_color_toolbar::y
    draw rect draw_color_toolbar::config.x_start draw_color_toolbar::y draw_color_toolbar::config.tools_width draw_color_toolbar::config.tools_width 0 0
    # pink
    draw color 255 0 255 255 0 0
    draw_color_toolbar::y -= draw_color_toolbar::config.tools_width
    g::color_toolbar::pink_pos = draw_color_toolbar::y
    draw rect draw_color_toolbar::config.x_start draw_color_toolbar::y draw_color_toolbar::config.tools_width draw_color_toolbar::config.tools_width 0 0
    # cyan
    draw color 0 255 255 255 0 0
    draw_color_toolbar::y -= draw_color_toolbar::config.tools_width
    g::color_toolbar::cyan_pos = draw_color_toolbar::y
    draw rect draw_color_toolbar::config.x_start draw_color_toolbar::y draw_color_toolbar::config.tools_width draw_color_toolbar::config.tools_width 0 0
    # brown
    draw color 155 103 60 255 0 0
    draw_color_toolbar::y -= draw_color_toolbar::config.tools_width
    g::color_toolbar::brown_pos = draw_color_toolbar::y
    draw rect draw_color_toolbar::config.x_start draw_color_toolbar::y draw_color_toolbar::config.tools_width draw_color_toolbar::config.tools_width 0 0

    # copy pasted code to increase speed
    read draw_color_toolbar::color.r draw_color_toolbar::config.mem draw_color_toolbar::mem_pos_color.r
    read draw_color_toolbar::color.g draw_color_toolbar::config.mem draw_color_toolbar::mem_pos_color.g
    read draw_color_toolbar::color.b draw_color_toolbar::config.mem draw_color_toolbar::mem_pos_color.b
    read draw_color_toolbar::color.t draw_color_toolbar::config.mem draw_color_toolbar::mem_pos_color.t
    draw color draw_color_toolbar::color.r draw_color_toolbar::color.g draw_color_toolbar::color.b draw_color_toolbar::color.t 0 0
    draw rect draw_color_toolbar::config.x_start 0 draw_color_toolbar::config.tools_width draw_color_toolbar::config.tools_width 0 0
}


function select_color(select_color::posy, select_color::mem, Color4D select_color::mem_pos) {
    # XXX: This can be optimized with direct counter jumps
    if select_color::posy > g::color_toolbar::black_pos {
        # black
        write 0 select_color::mem select_color::mem_pos.r
        write 0 select_color::mem select_color::mem_pos.g
        write 0 select_color::mem select_color::mem_pos.b
        write 255 select_color::mem select_color::mem_pos.t
        jump select_color::select_color_theend always 0 0
    }
    if select_color::posy > g::color_toolbar::gray_pos {
        # gray
        write 128 select_color::mem select_color::mem_pos.r
        write 128 select_color::mem select_color::mem_pos.g
        write 128 select_color::mem select_color::mem_pos.b
        write 255 select_color::mem select_color::mem_pos.t
        jump select_color::select_color_theend always 0 0
    }
    if select_color::posy > g::color_toolbar::white_pos {
        # white
        write 255 select_color::mem select_color::mem_pos.r
        write 255 select_color::mem select_color::mem_pos.g
        write 255 select_color::mem select_color::mem_pos.b
        write 255 select_color::mem select_color::mem_pos.t
        jump select_color::select_color_theend always 0 0
    }
    if select_color::posy > g::color_toolbar::red_pos {
        # red
        write 255 select_color::mem select_color::mem_pos.r
        write 0 select_color::mem select_color::mem_pos.g
        write 0 select_color::mem select_color::mem_pos.b
        write 255 select_color::mem select_color::mem_pos.t
        jump select_color::select_color_theend always 0 0
    }
    if select_color::posy > g::color_toolbar::green_pos {
        # green
        write 0 select_color::mem select_color::mem_pos.r
        write 255 select_color::mem select_color::mem_pos.g
        write 0 select_color::mem select_color::mem_pos.b
        write 255 select_color::mem select_color::mem_pos.t
        jump select_color::select_color_theend always 0 0
    }
    if select_color::posy > g::color_toolbar::blue_pos {
        # blue
        write 0 select_color::mem select_color::mem_pos.r
        write 0 select_color::mem select_color::mem_pos.g
        write 255 select_color::mem select_color::mem_pos.b
        write 255 select_color::mem select_color::mem_pos.t
        jump select_color::select_color_theend always 0 0
    }
    if select_color::posy > g::color_toolbar::yellow_pos {
        # yellow
        write 255 select_color::mem select_color::mem_pos.r
        write 255 select_color::mem select_color::mem_pos.g
        write 0 select_color::mem select_color::mem_pos.b
        write 255 select_color::mem select_color::mem_pos.t
        jump select_color::select_color_theend always 0 0
    }
    if select_color::posy > g::color_toolbar::pink_pos {
        # pink
        write 255 select_color::mem select_color::mem_pos.r
        write 0 select_color::mem select_color::mem_pos.g
        write 255 select_color::mem select_color::mem_pos.b
        write 255 select_color::mem select_color::mem_pos.t
        jump select_color::select_color_theend always 0 0
    }
    if select_color::posy > g::color_toolbar::cyan_pos {
        # cyan
        write 0 select_color::mem select_color::mem_pos.r
        write 255 select_color::mem select_color::mem_pos.g
        write 255 select_color::mem select_color::mem_pos.b
        write 255 select_color::mem select_color::mem_pos.t
        jump select_color::select_color_theend always 0 0
    }
    if select_color::posy > g::color_toolbar::brown_pos {
        # brown
        write 155 select_color::mem select_color::mem_pos.r
        write 103 select_color::mem select_color::mem_pos.g
        write 60 select_color::mem select_color::mem_pos.b
        write 255 select_color::mem select_color::mem_pos.t
        jump select_color::select_color_theend always 0 0
    }
    select_color::select_color_theend:
    noop
}
